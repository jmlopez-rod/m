---
sidebar_position: 40
sidebar_label: Testing
---

# API

## `KebabModel`

Inputs and outputs need to be written using a `KebabModel` as a base class. This
is so that their definitions may be written using kebab casing in the final
`action.yaml`.

```python
from m.github.actions import KebabModel, InArg

class MyInput(KebabModel):
    my_input: str = InArg(help='description')
```

## `InArg`

Should be used to declare the input arguments of an action. This is a function
that returns `Any` to bypass `mypy`'s type checking. Similar to `Field` from
`pydantic` but it is tailored to help us write the inputs for an action and its
steps.

### Args

- `help`: A description of the input argument.
- `default`: The default value of the input argument.

By default all input arguments are required. If you want to make an input not
required then provide a default value.

## `OutArg`

Should be used to declare the output arguments of an action.

### Args

- `help`: A description of the output argument.
- `export`: Whether or not to export the output to the action.

Every step has to the potential to expose its outputs to the action. If the
action has mutiple steps simply make sure that the output `export`s it.

## `run_action`

This is the main function that should be used to run an action. It takes in a
function that takes in a `KebabModel` and returns a `Res[KebabModel]`.

The only place where this function is needed is in the the if block

```python
if __name__ == '__main__':
    run_action(my_action)
```

`mypy` will make sure that the you are providing the correct type of function to
`run_action`. Keep in mind, the function is generic and we should be writing
models for the inputs and outputs for all of our functions.

## `RunStep`

This is a model used to define a step in an action.

### Args

- `id`: the step id
- `run`: The function passed to `run_action`.
- `args`: The arguments to pass to the function.

The id is important because this is how we will be able to refer to the outputs
generated by the step. Say our action called other external actions such as a
the cache action. Then if we wanted to pass one of the outputs to the cache
action we would have to get a handle on the step.

```python
args=SomeInput(some_arg='my_run_step_id.some_output')
```

The args should use the leverage the help of their own input models. All they
require is that we provide the handle to other outputs from other steps or some
other values we wish to pass.

Feel free to experiment with different values to see what `action.yaml`
generates.

## `UsesStep`

This is a model similar to `RunStep` but since we do not have access to the code
that gets executed all we can do is provide the `uses` field and our models to
describe what the action expects.

### Args

- `id`: the step id
- `uses`: A string referencing an action.
- `inputs`: A reference to a `KebabModel` type.
- `outputs`: A reference to a `KebabModel` type.
- `args`: The arguments to pass to the function.

For instance, say we wanted to use the `actions/cache@v3` action. To avoid
having issues in the future we should create the input and output models
manually by looking at the documentation
https://github.com/actions/cache#inputs.

```python
class CacheInputs(KebabModel):
    key: str = InArg(help='An explicit key for a cache entry')
    path: str = InArt(help='A list of files, directories, and wildcard patterns to cache and restore')
```

Similarly for the outputs we can define a model. This in the long run should
help us maintain the composite action better. It is recommended to check the
inputs and outputs as we update action versions to ensure compatability.

## `Action`

The main object to help us define the `actions.yaml` file. Each repository can
declare several actions. For this reason we can declare the `actions` object as
a single `Action` or a list of them.

### Args

- `file_path`: The full path to the `action.yaml` file.
- `name`: The name of the action.
- `description`: Short decription for the action.
- `inputs`: A model describing the inputs for the action. If the action does not
  need inputs then provide `None`. It is important to be explicit in this step
  so that we not wonder why we cannot use `inputs.[argname]` when we declare a
  step.
- `steps`: This is a list of `RunStep` or `UsesStep` instances.

We could technically do everything in one single step but when we use external
actions then we are forced to split our actions. Note that we have no way of
having the `if` fields in each step. This is because we are encourage to handle
that logic in each of the steps we declare. We have full control of the ouput to
`stdout` and `stderr` here.
